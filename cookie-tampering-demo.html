<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Security Insight: Cookie Tampering</title>

<style>
    * { box-sizing: border-box; }
    body {
        font-family: Arial, sans-serif;
        background: #1e1e1e;
        color: #f0f0f0;
        margin: 0;
    }

    .layout {
        display: flex;
        min-height: 100vh;
    }

    /* SIDEBAR ---------------------------------------------------- */
    .sidebar {
        width: 300px;
        background: #242424;
        padding: 25px;
        border-right: 2px solid #333;
        overflow-y: auto;
        max-height: 100vh;
    }

    .sidebar h2 { color: #61dafb; margin-bottom: 15px; }
    .sidebar h3 { margin-top: 18px; color: #ffa657; }
    .sidebar p { line-height: 1.45; margin-bottom: 10px; }
    .sidebar ul { margin-left: 18px; margin-bottom: 10px; }

    /* MAIN CONTENT ----------------------------------------------- */
    .content { flex: 1; padding: 40px; }
    .container {
        width: 850px;
        margin: auto;
        background: #2b2b2b;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    h1 {
        text-align: center;
        margin-bottom: 25px;
        color: #61dafb;
    }

    label { display: block; margin-bottom: 6px; }

    input[type="text"] {
        width: 100%;
        padding: 12px;
        background: #3b3b3b;
        border: none;
        border-radius: 6px;
        color: #fff;
        margin-bottom: 12px;
    }

    input[readonly] {
        opacity: 0.6;
    }

    .checkbox-row {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }

    button {
        padding: 12px 16px;
        background: #61dafb;
        color: #000;
        border: none;
        font-weight: bold;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
    }

    button:hover { background: #52c4e8; }

    .row {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .panel {
        flex: 1;
        min-width: 350px;
        background: #111;
        padding: 16px;
        border-radius: 8px;
    }

    .pill {
        display: inline-block;
        padding: 4px 8px;
        background: #333;
        color: #ccc;
        border-radius: 8px;
        font-size: 0.85em;
        margin-bottom: 10px;
    }

    .section-title {
        margin-top: 20px;
        color: #ffa657;
        font-size: 1.2em;
    }

    .good { color: #9fdb9f; }
    .bad  { color: #ff6f6f; }

    #log {
        background: #000;
        padding: 12px;
        border-radius: 8px;
        margin-top: 10px;
        font-family: "Courier New", monospace;
        white-space: pre-wrap;
    }

    .info-box {
        margin-top: 10px;
        background: #333;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.9em;
        opacity: 0.9;
    }

    /* TEACHING CONTENT BELOW DEMO */
    .teaching-section {
        background:#2b2b2b;
        padding:25px;
        border-radius:12px;
        margin-top:40px;
    }
    pre {
        background:#111;
        padding:12px;
        border-radius:8px;
        white-space:pre-wrap;
        overflow-x:auto;
        font-family:"Courier New", monospace;
    }

</style>
</head>

<body>

<div class="layout">

    <!-- SIDEBAR --------------------------------------------------- -->
    <div class="sidebar">
        <h2>Security Insight: Cookie Tampering</h2>

        <p>Cookie tampering occurs when a website stores sensitive data (like user roles) inside a cookie
        and trusts it without checking if it was changed.</p>

        <h3>What’s Going On?</h3>
        <p>Browsers allow users to edit cookies freely. If a server trusts those cookies without validation,
        attackers can escalate privileges.</p>

        <p>Example:</p>
        <p><code>role=user</code> → attacker modifies → <code>role=admin</code></p>

        <h3>Why It’s Important</h3>
        <ul>
            <li>Privilege escalation</li>
            <li>Gaining admin dashboards</li>
            <li>Editing other users’ data</li>
            <li>Bypassing authorisation controls</li>
        </ul>

        <h3>How Signed Cookies Help</h3>
        <p>A signed cookie includes a server‑generated signature. If modified, the signature fails.</p>

        <h3>How To Prevent Tampering</h3>
        <ul>
            <li>Use HMAC‑signed cookies</li>
            <li>Use server-side session storage</li>
            <li>Avoid storing trust‑critical data client‑side</li>
            <li>Secure/HttpOnly/SameSite attributes</li>
        </ul>
    </div>

    <!-- MAIN CONTENT --------------------------------------------- -->
    <div class="content">

        <div class="container">

            <h1>Cookie Tampering Demo</h1>

            <div class="checkbox-row">
                <input type="checkbox" id="signedMode" checked>
                <label for="signedMode">Use Signed Cookie Mode (recommended)</label>
            </div>

            <div id="modeInfo" class="info-box"></div>

            <div class="row">

                <!-- Client Cookie Panel -->
                <div class="panel">
                    <span class="pill">Client Cookie</span>

                    <label>role</label>
                    <input id="role" value="user" oninput="refreshSignature()">

                    <label>signature</label>
                    <input id="sig" readonly>

                    <button onclick="applyCookie()">Apply Cookie</button>
                </div>

                <!-- Server Panel -->
                <div class="panel">
                    <span class="pill">Server Decision</span>

                    <div class="section-title">Access Result</div>
                    <div id="access" class="panel" style="background:#0e0e0e;"></div>

                    <div class="section-title">Server Log</div>
                    <div id="log"></div>
                </div>

            </div>
        </div>

        <!-- ===================================================== -->
        <!-- TEACHING SECTION (below demo)                         -->
        <!-- ===================================================== -->
        <div class="teaching-section">

            <h2 class="section-title">1. Learning Outcomes</h2>
            <ul>
                <li>Explain what cookie tampering is</li>
                <li>Identify insecure client‑side trust patterns</li>
                <li>Perform a safe cookie tampering demonstration</li>
                <li>Describe signed cookies and how they prevent tampering</li>
                <li>Apply secure storage patterns for session and role data</li>
            </ul>

            <h2 class="section-title">2. Introduction to Cookie Tampering</h2>
            <p>
                Cookie tampering happens when applications store important security values (like roles, access levels, or flags)
                inside client‑side cookies and then trust them without verification.
                Attackers can open browser developer tools, modify the cookie, and send it back to the server.
            </p>

            <p>Common examples include:</p>
            <ul>
                <li><code>role=user</code> → attacker edits → <code>role=admin</code></li>
                <li><code>paid=false</code> → edited to → <code>paid=true</code></li>
                <li><code>tier=basic</code> → changed to → <code>tier=premium</code></li>
            </ul>

            <h2 class="section-title">3. Why Cookie Tampering Happens</h2>

            <h3>3.1 Trusting Client-Side Data</h3>
            <p>Anything stored client‑side (cookies, localStorage, sessionStorage) can be modified by the user.</p>

            <h3>3.2 Lack of Cookie Integrity Checking</h3>
            <p>If the server never validates the cookie, any modified value appears legitimate.</p>

            <h3>3.3 Storing Roles or Permissions in Cookies</h3>
            <p>
                Role-based access control must be enforced server-side.
                If “admin=true” is stored in a cookie without validation, attackers simply flip it.
            </p>

            <h2 class="section-title">4. Attack Flow Diagram</h2>
            <pre>
User reads/modifies cookie via DevTools
            ↓
Sends forged cookie to server
            ↓
Server trusts cookie blindly
            ↓
Attacker gains elevated privileges
            </pre>

            <h2 class="section-title">5. Demo Scenario (Explanation)</h2>

            <h3>Unsigned Mode</h3>
            <pre>
role=admin
signature= (none)
→ Server trusts the role and grants admin access
            </pre>

            <h3>Signed Mode</h3>
            <pre>
role=admin
signature=HMAC(role, secret)
→ If role changes, signature becomes invalid → Access denied
            </pre>

            <h2 class="section-title">6. Vulnerable vs Secure Examples</h2>
            <h3>❌ Vulnerable</h3>
            <pre>
cookie = "role=" + roleFromUser;
if (cookie.role === "admin") allowAccess();
            </pre>

            <h3>✅ Secure (Signed Cookies)</h3>
            <pre>
cookie = {
   role: "user",
   sig: HMAC("user", secret)
};
if (!verifySignature(cookie)) deny();
            </pre>

            <h3>Even More Secure: Server-Side Sessions</h3>
            <pre>
session.user = "admin"; // stored server-side only
client gets only a session ID
            </pre>

            <h2 class="section-title">7. Real-World Case Studies</h2>

            <h3>1. Steam (Early 2010s)</h3>
            <p>Unsigned cookies allowed tampering with user preferences and settings.</p>

            <h3>2. Old PHP Apps (Common)</h3>
            <p>Roles stored in plain cookies led to privilege escalation.</p>

            <h3>3. E-commerce Sites</h3>
            <p>Attackers modified “paid=false → paid=true” to access premium features.</p>

            <h2 class="section-title">8. Summary / Key Takeaways</h2>
            <ul>
                <li>Clients control cookies — never trust them without verification</li>
                <li>Signed cookies prevent modification attacks</li>
                <li>Do not store roles or permissions client-side</li>
                <li>Server-side session storage is the safest pattern</li>
                <li>Security attributes (HttpOnly, Secure, SameSite) further protect cookies</li>
            </ul>

        </div>

    </div>
</div>

<script>
// Simulated secret for signing
const SECRET = "server-secret";

// Fake "HMAC" (teaching only)
function fakeSign(data) {
    return btoa(data + "|" + SECRET);
}

function refreshSignature() {
    const signed = document.getElementById("signedMode").checked;
    const role = document.getElementById("role").value.trim();
    document.getElementById("sig").value = signed ? fakeSign(role) : "";
}

document.getElementById("signedMode").addEventListener("change", () => {
    updateModeInfo();
    refreshSignature();
});

function updateModeInfo() {
    const signed = document.getElementById("signedMode").checked;
    const info = document.getElementById("modeInfo");

    if (signed) {
        info.innerHTML = `
            <strong>Signed Mode Enabled:</strong><br>
            The server verifies the signature. If the cookie is modified,
            the signature will not match and the request will be rejected.
        `;
        document.getElementById("sig").setAttribute("readonly", "true");
    } else {
        info.innerHTML = `
            <strong>Unsigned Mode (Insecure):</strong><br>
            The server blindly trusts the cookie.
            Changing <code>role=user</code> to <code>role=admin</code>
            gives full access.
        `;
        document.getElementById("sig").removeAttribute("readonly");
        document.getElementById("sig").value = "";
    }
}

updateModeInfo();
refreshSignature();

function applyCookie() {
    const role = document.getElementById("role").value.trim();
    const sig = document.getElementById("sig").value;
    const signed = document.getElementById("signedMode").checked;

    let log = "";
    let allowed = false;

    log += `Received cookie:
role=${role}
signature=${sig || "(none)"}

`;

    if (!signed) {
        log += "Unsigned mode: trusting cookie.\n";
        allowed = (role === "admin");
    } else {
        const expected = fakeSign(role);
        log += `Expected signature: ${expected}\n`;

        if (sig === expected) {
            log += "Signature valid.\n";
            allowed = (role === "admin");
        } else {
            log += "Signature mismatch — cookie tampered.\n";
            allowed = false;
        }
    }

    document.getElementById("access").innerHTML =
        allowed
            ? `<span class="good">✔ Access Granted (Admin)</span>`
            : `<span class="bad">❌ Access Denied</span>`;

    document.getElementById("log").textContent = log;
}
</script>

</body>
</html>
